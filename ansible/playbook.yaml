- hosts: all
  tasks:
  - name: "Ping {{ inventory_hostname }}"
    ping:
    register: ping_info

  - name: "Show ping_info in console"
    debug:
      msg: "{{ ping_info }}"

- hosts: swarm
  tasks:
  - name: "Install Docker {{ inventory_hostname }}"
    shell:
      cmd: curl https://get.docker.com | bash

  - name: "assign Jenkins to Docker group {{ inventory_hostname }}"
    ansible.builtin.user:
      name: jenkins
      shell: /bin/bash
      groups: docker
      append: yes


- hosts: server
  tasks: 
  - name: "Install Nginx on {{ inventory_hostname }}"
    apt:
      name: nginx
      state: latest
      update_cahce: true

  - name: "Config nginx"
    copy:
      src: xxxxx
      dest: xxxxx
    register: nginx_config
    
  - name: "Start Nginx on {{ inventory_hostname }}"
    service:
      name: nginx
      state: started
  
  - name: "Restart Nginx on {{ inventory_hostname }}"
    service:
      name: nginx
      state: restarted
    when: nginx_config.changed == true